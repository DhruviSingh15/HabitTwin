{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Leaderboard</h1>
        <p class="text-gray-600">See how you stack up against other users in habit consistency and achievements</p>
    </div>
    
    <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
        <div class="bg-indigo-600 text-white py-4 px-6 flex justify-between items-center">
            <h2 class="text-xl font-bold">Top Achievers</h2>
            <div class="flex space-x-2">
                <button id="btn-achievements" class="bg-white text-indigo-600 px-3 py-1 rounded-lg text-sm font-medium hover:bg-indigo-100">Achievements</button>
                <button id="btn-streaks" class="bg-transparent border border-white text-white px-3 py-1 rounded-lg text-sm font-medium hover:bg-white hover:bg-opacity-20">Streaks</button>
                <button id="btn-completion" class="bg-transparent border border-white text-white px-3 py-1 rounded-lg text-sm font-medium hover:bg-white hover:bg-opacity-20">Completion</button>
            </div>
        </div>
        
        <!-- Achievements Leaderboard -->
        <div id="achievements-leaderboard" class="p-6">
            {% if leaderboard %}
                <div class="space-y-4">
                    {% for user in leaderboard %}
                        <div class="flex items-center {% if user.username == current_user.username %}bg-indigo-50{% else %}bg-gray-50{% endif %} p-4 rounded-lg">
                            <div class="flex items-center justify-center w-10 h-10 rounded-full 
                                {% if loop.index == 1 %}
                                    bg-yellow-100 text-yellow-600
                                {% elif loop.index == 2 %}
                                    bg-gray-200 text-gray-600
                                {% elif loop.index == 3 %}
                                    bg-amber-100 text-amber-600
                                {% else %}
                                    bg-indigo-100 text-indigo-600
                                {% endif %} mr-4 font-bold">
                                {{ loop.index }}
                            </div>
                            <div class="flex items-center">
                                <img src="{{ url_for('static', filename='uploads/profile_pics/' + user.profile_pic) }}" 
                                     alt="Profile" class="w-10 h-10 rounded-full mr-3">
                                <div>
                                    <p class="font-medium {% if user.username == current_user.username %}text-indigo-600{% endif %}">
                                        {{ user.username }}
                                    </p>
                                    <p class="text-xs text-gray-500">HabitTwin User</p>
                                </div>
                            </div>
                            <div class="ml-auto flex items-center">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 mr-2">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <span class="font-bold text-xl">{{ user.achievements_count }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="bg-gray-50 rounded-lg p-6 text-center">
                    <p class="text-gray-600">No leaderboard data available yet.</p>
                </div>
            {% endif %}
        </div>
        
        <!-- Streaks Leaderboard -->
        <div id="streaks-leaderboard" class="p-6 hidden">
            {% if leaderboard %}
                <div class="space-y-4">
                    {% for user in leaderboard %}
                        <div class="flex items-center {% if user.username == current_user.username %}bg-indigo-50{% else %}bg-gray-50{% endif %} p-4 rounded-lg">
                            <div class="flex items-center justify-center w-10 h-10 rounded-full 
                                {% if loop.index == 1 %}
                                    bg-yellow-100 text-yellow-600
                                {% elif loop.index == 2 %}
                                    bg-gray-200 text-gray-600
                                {% elif loop.index == 3 %}
                                    bg-amber-100 text-amber-600
                                {% else %}
                                    bg-indigo-100 text-indigo-600
                                {% endif %} mr-4 font-bold">
                                {{ loop.index }}
                            </div>
                            <div class="flex items-center">
                                <img src="{{ url_for('static', filename='uploads/profile_pics/' + user.profile_pic) }}" 
                                     alt="Profile" class="w-10 h-10 rounded-full mr-3">
                                <div>
                                    <p class="font-medium {% if user.username == current_user.username %}text-indigo-600{% endif %}">
                                        {{ user.username }}
                                    </p>
                                    <p class="text-xs text-gray-500">HabitTwin User</p>
                                </div>
                            </div>
                            <div class="ml-auto flex items-center">
                                <div class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 mr-2">
                                    <i class="fas fa-fire"></i>
                                </div>
                                <span class="font-bold text-xl">{{ user.longest_streak }}</span>
                                <span class="text-gray-500 text-sm ml-1">days</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="bg-gray-50 rounded-lg p-6 text-center">
                    <p class="text-gray-600">No streak data available yet.</p>
                </div>
            {% endif %}
        </div>
        
        <!-- Completion Leaderboard -->
        <div id="completion-leaderboard" class="p-6 hidden">
            {% if leaderboard %}
                <div class="space-y-4">
                    {% for user in leaderboard %}
                        <div class="flex items-center {% if user.username == current_user.username %}bg-indigo-50{% else %}bg-gray-50{% endif %} p-4 rounded-lg">
                            <div class="flex items-center justify-center w-10 h-10 rounded-full 
                                {% if loop.index == 1 %}
                                    bg-yellow-100 text-yellow-600
                                {% elif loop.index == 2 %}
                                    bg-gray-200 text-gray-600
                                {% elif loop.index == 3 %}
                                    bg-amber-100 text-amber-600
                                {% else %}
                                    bg-indigo-100 text-indigo-600
                                {% endif %} mr-4 font-bold">
                                {{ loop.index }}
                            </div>
                            <div class="flex items-center">
                                <img src="{{ url_for('static', filename='uploads/profile_pics/' + user.profile_pic) }}" 
                                     alt="Profile" class="w-10 h-10 rounded-full mr-3">
                                <div>
                                    <p class="font-medium {% if user.username == current_user.username %}text-indigo-600{% endif %}">
                                        {{ user.username }}
                                    </p>
                                    <p class="text-xs text-gray-500">{{ user.completed_habits }} completed habits</p>
                                </div>
                            </div>
                            <div class="ml-auto flex items-center">
                                <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 mr-2">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <span class="font-bold text-xl">{{ (user.completed_habits / 100 * 80)|int }}</span>
                                <span class="text-gray-500 text-sm ml-1">%</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="bg-gray-50 rounded-lg p-6 text-center">
                    <p class="text-gray-600">No completion rate data available yet.</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Your Position -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Your Position</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-indigo-50 p-4 rounded-lg text-center">
                <div class="w-12 h-12 mx-auto mb-2 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 text-xl">
                    <i class="fas fa-trophy"></i>
                </div>
                <p class="text-sm text-gray-600 mb-1">Achievements Rank</p>
                <p class="text-2xl font-bold text-indigo-600">
                    {% if user_achievement_rank %}
                        #{{ user_achievement_rank }}
                    {% else %}
                        -
                    {% endif %}
                </p>
            </div>
            
            <div class="bg-orange-50 p-4 rounded-lg text-center">
                <div class="w-12 h-12 mx-auto mb-2 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 text-xl">
                    <i class="fas fa-fire"></i>
                </div>
                <p class="text-sm text-gray-600 mb-1">Streak Rank</p>
                <p class="text-2xl font-bold text-orange-600">
                    {% if user_streak_rank %}
                        #{{ user_streak_rank }}
                    {% else %}
                        -
                    {% endif %}
                </p>
            </div>
            
            <div class="bg-green-50 p-4 rounded-lg text-center">
                <div class="w-12 h-12 mx-auto mb-2 rounded-full bg-green-100 flex items-center justify-center text-green-600 text-xl">
                    <i class="fas fa-check-circle"></i>
                </div>
                <p class="text-sm text-gray-600 mb-1">Completion Rank</p>
                <p class="text-2xl font-bold text-green-600">
                    {% if user_completion_rank %}
                        #{{ user_completion_rank }}
                    {% else %}
                        -
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const btnAchievements = document.getElementById('btn-achievements');
        const btnStreaks = document.getElementById('btn-streaks');
        const btnCompletion = document.getElementById('btn-completion');
        
        const achievementsLeaderboard = document.getElementById('achievements-leaderboard');
        const streaksLeaderboard = document.getElementById('streaks-leaderboard');
        const completionLeaderboard = document.getElementById('completion-leaderboard');
        
        btnAchievements.addEventListener('click', function() {
            // Show achievements leaderboard, hide others
            achievementsLeaderboard.classList.remove('hidden');
            streaksLeaderboard.classList.add('hidden');
            completionLeaderboard.classList.add('hidden');
            
            // Update button styles
            btnAchievements.classList.remove('bg-transparent', 'border', 'border-white', 'text-white');
            btnAchievements.classList.add('bg-white', 'text-indigo-600');
            
            btnStreaks.classList.remove('bg-white', 'text-indigo-600');
            btnStreaks.classList.add('bg-transparent', 'border', 'border-white', 'text-white');
            
            btnCompletion.classList.remove('bg-white', 'text-indigo-600');
            btnCompletion.classList.add('bg-transparent', 'border', 'border-white', 'text-white');
        });
        
        btnStreaks.addEventListener('click', function() {
            // Show streaks leaderboard, hide others
            achievementsLeaderboard.classList.add('hidden');
            streaksLeaderboard.classList.remove('hidden');
            completionLeaderboard.classList.add('hidden');
            
            // Update button styles
            btnAchievements.classList.remove('bg-white', 'text-indigo-600');
            btnAchievements.classList.add('bg-transparent', 'border', 'border-white', 'text-white');
            
            btnStreaks.classList.remove('bg-transparent', 'border', 'border-white', 'text-white');
            btnStreaks.classList.add('bg-white', 'text-indigo-600');
            
            btnCompletion.classList.remove('bg-white', 'text-indigo-600');
            btnCompletion.classList.add('bg-transparent', 'border', 'border-white', 'text-white');
        });
        
        btnCompletion.addEventListener('click', function() {
            // Show completion leaderboard, hide others
            achievementsLeaderboard.classList.add('hidden');
            streaksLeaderboard.classList.add('hidden');
            completionLeaderboard.classList.remove('hidden');
            
            // Update button styles
            btnAchievements.classList.remove('bg-white', 'text-indigo-600');
            btnAchievements.classList.add('bg-transparent', 'border', 'border-white', 'text-white');
            
            btnStreaks.classList.remove('bg-white', 'text-indigo-600');
            btnStreaks.classList.add('bg-transparent', 'border', 'border-white', 'text-white');
            
            btnCompletion.classList.remove('bg-transparent', 'border', 'border-white', 'text-white');
            btnCompletion.classList.add('bg-white', 'text-indigo-600');
        });
    });
</script>
{% endblock %}
